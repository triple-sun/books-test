import { PrismaClient } from '@prisma/client';
import { genSalt, hash } from 'bcrypt';

const prisma = new PrismaClient();

const getSeedUserPassHash = async () => {
  const pass = process.env['SEED_USER_PASS'];
  const salt = await genSalt(10);

  if (!pass) {
    throw new Error('Seed user password is undefined');
  }

  return await hash(pass, salt);
};

async function fillDb() {
  const seedUserPassHash = await getSeedUserPassHash();

  await prisma.user.create({
    data: {
      name: 'ÐÐ½Ð´Ñ€ÐµÐ¹',
      email: 'andrew@mail.local',
      passwordHash: seedUserPassHash,
    },
  });

  await prisma.user.create({
    data: {
      name: 'Ð®Ð»Ð¸Ñ',
      email: 'yulia@mail.local',
      passwordHash: seedUserPassHash,
      books: {
        create: [
          {
            title: 'Ð’Ð»Ð°ÑÑ‚ÐµÐ»Ð¸Ð½ ÐºÐ¾Ð»ÐµÑ†',
            author: 'Ð”Ð¶Ð¾Ð½ Ð Ð¾Ð½Ð°Ð»ÑŒÐ´ Ð ÑƒÑÐ½ Ð¢Ð¾Ð»ÐºÐ¸Ð½',
            year: 1954,
            desc: 'Â«Ð’Ð»Ð°ÑÑ‚ÐµÐ»Ð¸ÌÐ½ ÐºÐ¾Ð»ÐµÌÑ†Â» (Ð°Ð½Ð³Ð». The Lord of the Rings) â€” Ñ€Ð¾Ð¼Ð°Ð½-ÑÐ¿Ð¾Ð¿ÐµÑ Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð³Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÐµÐ»Ñ Ð”Ð¶. Ð . Ð . Ð¢Ð¾Ð»ÐºÐ¸Ð½Ð°, Ð¾Ð´Ð½Ð¾ Ð¸Ð· ÑÐ°Ð¼Ñ‹Ñ… Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¹ Ð¶Ð°Ð½Ñ€Ð° Ñ„ÑÐ½Ñ‚ÐµÐ·Ð¸. Â«Ð’Ð»Ð°ÑÑ‚ÐµÐ»Ð¸Ð½ ÐºÐ¾Ð»ÐµÑ†Â» Ð±Ñ‹Ð» Ð½Ð°Ð¿Ð¸ÑÐ°Ð½ ÐºÐ°Ðº ÐµÐ´Ð¸Ð½Ð°Ñ ÐºÐ½Ð¸Ð³Ð°, Ð½Ð¾ Ð¸Ð·-Ð·Ð° Ð¾Ð±ÑŠÑ‘Ð¼Ð° Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð¸Ð·Ð´Ð°Ð½Ð¸Ð¸ ÐµÐ³Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ð»Ð¸ Ð½Ð° Ñ‚Ñ€Ð¸ Ñ‡Ð°ÑÑ‚Ð¸ â€” Â«Ð‘Ñ€Ð°Ñ‚ÑÑ‚Ð²Ð¾ ÐšÐ¾Ð»ÑŒÑ†Ð°Â», Â«Ð”Ð²Ðµ ÐºÑ€ÐµÐ¿Ð¾ÑÑ‚Ð¸Â» Ð¸ Â«Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ ÐºÐ¾Ñ€Ð¾Ð»ÑÂ». Ð’ Ð²Ð¸Ð´Ðµ Ñ‚Ñ€Ð¸Ð»Ð¾Ð³Ð¸Ð¸ Ð¾Ð½ Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐµÑ‚ÑÑ Ð¸ Ð¿Ð¾ ÑÐµÐ¹ Ð´ÐµÐ½ÑŒ, Ñ…Ð¾Ñ‚Ñ Ñ‡Ð°ÑÑ‚Ð¾ Ð² ÐµÐ´Ð¸Ð½Ð¾Ð¼ Ñ‚Ð¾Ð¼Ðµ. Ð Ð¾Ð¼Ð°Ð½ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸ÐµÐ¼ Ð¶Ð°Ð½Ñ€Ð° ÑÐ¿Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ñ„ÑÐ½Ñ‚ÐµÐ·Ð¸, Ð° Ñ‚Ð°ÐºÐ¶Ðµ ÐµÐ³Ð¾ ÐºÐ»Ð°ÑÑÐ¸ÐºÐ¾Ð¹.',
          },
          {
            title: 'Ð©ÐµÐ³Ð¾Ð»',
            author: 'Ð”Ð¾Ð½Ð½Ð° Ð¢Ð°Ñ€Ñ‚Ñ‚',
            year: 2013,
            desc: 'Â«Ð©ÐµÐ³Ð¾Ð»Â» (Ð°Ð½Ð³Ð». The Goldfinch) â€” Ñ‚Ñ€ÐµÑ‚Ð¸Ð¹ Ñ€Ð¾Ð¼Ð°Ð½ Ð°Ð¼ÐµÑ€Ð¸ÐºÐ°Ð½ÑÐºÐ¾Ð¹ Ð¿Ð¸ÑÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð¸Ñ†Ñ‹ Ð”Ð¾Ð½Ð½Ñ‹ Ð¢Ð°Ñ€Ñ‚Ñ‚, Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð² 2013 Ð³Ð¾Ð´Ñƒ. Ð Ð¾Ð¼Ð°Ð½ Ð½Ð°Ð·Ð²Ð°Ð½ Ð² Ñ‡ÐµÑÑ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ð¸Ð½Ñ‹ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾Ð³Ð¾ Ð³Ð¾Ð»Ð»Ð°Ð½Ð´ÑÐºÐ¾Ð³Ð¾ Ñ…ÑƒÐ´Ð¾Ð¶Ð½Ð¸ÐºÐ° ÐšÐ°Ñ€ÐµÐ»Ð° Ð¤Ð°Ð±Ñ€Ð¸Ñ†Ð¸ÑƒÑÐ° Â«Ð©ÐµÐ³Ð¾Ð»Â» (1654), ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¸Ð³Ñ€Ð°ÐµÑ‚ Ð²Ð°Ð¶Ð½ÑƒÑŽ Ñ€Ð¾Ð»ÑŒ Ð² ÑÑƒÐ´ÑŒÐ±Ðµ Ð³Ð»Ð°Ð²Ð½Ð¾Ð³Ð¾ Ð³ÐµÑ€Ð¾Ñ. ÐšÐ½Ð¸Ð³Ð° ÑÑ‚Ð°Ð»Ð° Ð»Ð°ÑƒÑ€ÐµÐ°Ñ‚Ð¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¸Ñ… Ð½Ð°Ð³Ñ€Ð°Ð´, Ð² Ñ‚Ð¾Ð¼ Ñ‡Ð¸ÑÐ»Ðµ ÐŸÑƒÐ»Ð¸Ñ‚Ñ†ÐµÑ€Ð¾Ð²ÑÐºÐ¾Ð¹ Ð¿Ñ€ÐµÐ¼Ð¸Ð¸ Ð·Ð° Ñ…ÑƒÐ´Ð¾Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½ÑƒÑŽ ÐºÐ½Ð¸Ð³Ñƒ 2014 Ð³Ð¾Ð´Ð°.',
          },
        ],
      },
    },
  });

  console.info('ðŸ¤˜ï¸ Database was filled');
}

fillDb()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (err) => {
    console.error(err);
    await prisma.$disconnect();

    process.exit(1);
  });
